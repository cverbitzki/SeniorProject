% % % Headers and definitions
\documentclass{report}
%\usepackage{times}
\usepackage{fullpage} % sets more standardized margins
\usepackage{graphicx} % some graphics functions I use 
\usepackage{abstract} % abstract function
\usepackage{mathtools}
\usepackage{float}
\usepackage{array}
\usepackage{gensymb}

\renewcommand{\absnamepos}{flushleft} % left justifies abstract
\setlength{\absleftindent}{0pt}
\setlength{\absrightindent}{0pt}

% % %
% Set up IEEE style paragraphing
% % %
\setlength{\parskip}{1em} % The \par command now skips a line between paragraphs, eliminates warnings from using the \par or \\ commands
\setlength{\parindent}{0em} % Left justifies paragraphs after a \par command 
\usepackage{etoolbox}
\makeatletter
\pretocmd{\section}{\addtocontents{toc}{\protect\addvspace{0\p@}}}{}{}
\pretocmd{\subsection}{\addtocontents{toc}{\protect\addvspace{0\p@}}}{}{}
\pretocmd{\subsubsection}{\addtocontents{toc}{\protect\addvspace{0\p@}}}{}{}
\makeatother

\begin{document}

\pagenumbering{gobble} % Turn off page numbering for titles and tables

% Title and author

\title{ \textbf{ECE 403 Design Project}\\
	{Door Lock Monitoring System Report}\\
	University of Maine}
\author{Jordan Millett, Computer Engineering\\
  	Christopher Verbitzki, Computer Engineering}
\date{Febuary 13, 2017}
\maketitle


% % % % % % % % % % % % % % %		
% Abstract 
\begin{abstract}
The design of the electronic door lock system is described. The system  receives input from a physical keypad or through a web server to lock or unlock a deadbolt door lock. The web server is hosted on a Raspberry Pi. It features user access control, displaying the status of the lock, and history of access. The system also is able to feed a picture of what is in front of the door to the web server as well as controlling the outside lighting. An Android application and web client are designed to interface with the web server. A breakout board is designed for the Raspberry Pi. The breakout board handles the control of the dead bolt and outside lighting based off of input from the Pi or keypad.
\end{abstract}

% % % % % % % % % % % % % % % 
% Tables of contents, figures, tables, acronyms, etc
\newpage % jumps to new page

\tableofcontents


\newpage
\listoffigures
\listoftables

\newpage 
\clearpage

\pagenumbering{arabic} % Turn on page numbering

% % % % % % % % % % % % % % %
% Introduction
\chapter{Introduction}
Jordan

The design and testing of the Door Lock Monitoring System is descried. throughout the report. Section 2 will present a breakdown or overview of the project. The design and details that make up the project will be explored in Section 3. The results recorded will be provided in Section 4 and Section 5 will conclude the report.

\section{Project Purpose}
Ever since the start of the 21st century technology has been rapidly advancing. In the early 2000's cell phone devices were not nearly as popular as they are today. With this growth and advancement, cell phones are now can be used as a valuable key in the area of home automation. This Door Lock Monitoring System provides a unique connection between the billions of cellphone and home owners. The system allows these owners to have full control of their homes doors from almost anywhere in the world. Owners of homes without this system are unaware of the activity at their home while they are away. Users of this system are able to check the door locks current state and have the ability to toggle the locks state to the lock or unlocked position. Some other features this system provides is the ability to views images of the doors surroundings and receive real time notifications of doorbell activity. With this system forgetting a physical key will never be a problem again because a password can be entered into a keypad on the door.

\section{Project Description}
This system was designed as a replacement for a conventional deadbolt door lock. The system is able to lock/unlock a deadbolt by driving a stepper motor either clockwise or counter clockwise. The lock state can be seen and manipulated on an Android application, website interface, and keypad. A camera is also fixed outside of the door which can be manipulated by both the Android application and website interface to show the user up to date images of their homes surrounds. If the user is checking the homes surroundings at night time they are also provided with a feature to see the state and toggle the state of a light by the camera. During a power outage this system is equipt with a backup battery designed to allow the systems core functions to work. These core functions consist of manipulation of the lock and light with only the physical keypad interface.

\section{Project Specifications}
Jordan
%PUT SPECIFICATIONS IN TABLE SHEAFF DOESNT LIKE LISTS
% % % % % % % % % % % % % % %
% Overview
\chapter{Breakdown}
This section provides a brief overview of the main functional blocks that make up this project. The functional blocks consist of the user interface (UI) or inputs, hardware attached to Raspberry Pi, motor driver, light controller, and battery backup. This section will further look into both the hardware and software components of the functional blocks listed. Figure \ref{fig:BlockDiag} below shows the block diagram of the project.

\begin{figure}[H]
\centering
\includegraphics[width=.7\textwidth]{BlockDiagram_v2.png}
\caption{Functional block diagram of Door Lock Monitoring System}
\label{fig:BlockDiag}
\end{figure}

As Figure \ref{fig:BlockDiag} shows, the system is powered by a Battery Backup circuit that is used to switch between mains power and battery power depending on availability. When on battery power only essential functions of the lock are in operation. The Door Lock Monitoring System works as two halves, which are connected between the Web Server and Control Unit. One half, with the Web Server, receives input from either the Android Application or Website and informs the Control Unit appropriately. Lastly on the other side, with the Control Unit, handles the Physical UI or keypad, as well as controlling the door lock itself or the light switch based on one of the inputs. 

\section{Hardware}
There are four blocks from Figure \ref{fig:BlockDiag} that are made up of hardware. The only functional block that has no hardware is the user interface which is made up of only software running on the Raspberry Pi and a smart phone with an Android operating system. The following subsections look at the hardware aspects of the functional blocks in Figure \ref{fig:BlockDiag}.

\subsection{Keypad Interface}
The keypad is the physical user interface that can be used to control the lock. Capabilities include unlocking and locking the door with a user set pass code, controlling the light switch, and changing the pass code. The keypad interface also uses two LEDs to inform the user about the state of the lock, and for when changing the pass code. 

\subsection{Battery Backup}
The battery backup is what handles the power delivery for the rest of the components. The circuit will normally use mains power, but when it is unplugged, or during a power outage, will switch to battery power. To maximize battery life, only critical components will actually receive battery power during an outage. These being the control unit and the motor driver. The battery backup circuit was designed such that there will be no loss of power to the components when switching between mains and the battery.

\subsection{Motor Driver}
The motor driver powers the motor based off of input from the control unit. The control unit is not able to supply enough power to move the motor, so it simply controls the motor driver, which handles the power delivery. The door lock motor is a two-phase stepper motor, meaning there are two phases in the motor that need to be powered separately. Furthermore, the current through the phases has to be able to be reversed, therefore the motor driver consists of two H-bridges which are able to meet these requirements. 

\subsection{Light Switch}
The light switching circuit is composed of a few components that allow the control unit to turn on and off a 120 VAC light bulb with only a 5V signal. The circuit uses an optoisolator and a bidirectional triode thyristor (TRIAC) to achieve this. The optoisolator was used in this circuit to keep the power to the control unit separated from the 120 VAC power. The purpose of the TRIAC is to allow such a small voltage and current produced from the control unit to control a much larger voltage and current that is used to light the light bulb.

\section{Software}
For this project software was developed in a variety of different programming languages. Software was developed for the control unit, Android Application, Website interface, and for the serial peripheral interface between the Raspberry Pi and control unit. The following subsections will provide a breakdown of the systems developed software.

\subsection{Control Unit}
The control unit for this project has three inputs and three outputs. The inputs consist of first the keypad presses which are used to verify the password for locking/unlocking the deadbolt. The other input to the system is information being sent from the Raspberry Pi over SPI. This information contains a code that informs the control unit of the current lock state, light state, and doorbell state. The final input to the control unit is two readings from two photo sensors that are set on the deadbolts locked and unlocked position. These sensors are used to verify if the deadbolt is in the same position that software thinks it is in.

The first output of the control unit is four control signals that are sent to the motor driver circuit which are used to energize the two phases on the stepper motor. The next output is a single control signal that is sent to the light control unit circuit that simply switches the 120 VAC on and off. The final output is multiple control signals that are used to illuminate infrared (IR) light emitting diodes (LED), an red green blue (RGB) LED, and two green LEDs. The IR LEDs are used to establish a light source for the photo photo sensor inputs. The RGB led is used to indicate the current state of the deadbolt lock. The green LEDs are used to provide feedback to the user of what mode the system is currently in.

\subsection{Serial Peripheral Interface}

The communication protocol for this system uses the serial peripheral interface (SPI). The purpose of this protocol is to transfer information between the control unit and the Raspberry Pi. This information consists of the current locks state, light state, and doorbell state. The two sides of this communication are working to update each side to the same correct states. 

\subsection{Web Interface and Android Application}
The on the go control for this project is made up of a web server, website interface, and Android application interface. The web server is used to host the website, provide information for the Android application, and store data in a SQL database on the back end. The website interface is used to allow the user of the system to view a log of the door locks activity, toggle the state of the lock, toggle the state of the light, and view a picture of the doors surroundings. The Android applications purpose is similar to the website interface in the sense that it has all the same features as the website. The Android application has a feature that is not on the website which is a doorbell monitor. When the doorbell is pressed on the system the Android application will receive a notification saying "Doorbell Rang" and then after 5 seconds another notification will appear with four different pictures of the doors surroundings so the user can know who rang the doorbell.

% % % % % % % % % % % % % % %		
% Design
\chapter{Design}

Jordan

\section{Hardware Design}
Jordan

\subsection{Keypad}
Chris

\subsection{Motor Driver}
Chris

\subsection{Battery Backup}
Jordan

\subsection{Light Switching}
Jordan

\section{Software Design}
This section looks at the software that was developed for the Android application, website interface, control unit, and Raspberry Pi. Section 3.2.1 will discuss the software developed for the control unit mounted on the main board. The software developed for the serial peripheral interface between the Raspberry Pi and control unit will be discussed in Section 3.2.2. Finally Section 3.2.3 will the Android application software and includes details about the web scraping methods, interface, and background process.

\subsection{Control Unit}
The control unit is made up of the ATMEGA88A-PU microcontroller. The software running on this microcontroller is developed in the programming language C. Immediately when the system is powered on the software will check if a current lock state exists in the electrically erasable programmable read-only memory (eeprom) and then will compare this state to the actual state of the physical lock which is determined by the photo sensors. If no lock state exists in eeprom the lock state will be updated to the actual lock state provided from the photo sensors detection. The users password for the system and the light state are also stored in the control units eeprom. 

The next part of the software developed consists of an endless loop where the program hangs. In this loop there are two main goals the program needs to accomplish. The first goal is to communicate to the Raspberry Pi through SPI to update both sides of the correct lock state, light state, and doorbell state. The software developed for the SPI communication will be further looked at in Section 3.2.2. The second goal of the program is to check for a key press on the keypad and then act accordingly. 

The keypad scanning software needs to handle accomplish five tasks. The first three tasks consist of single button presses of either the '*', '\#', or 'A' buttons. The first button '*' is essentially used as a reset button to clear the current password digits that have been entered. The next button '\#' is simply used to toggle the state of light bulb. The third button 'A' is used to represent and acts as the doorbell to the system. The fourth task the keypad scanning needs to account for is once the correct number of password digits is entered the software will check to verify if the password is correct. The final task is the software will allow the user to change to current password if the sequence '0000' is entered. After this sequence is entered the current password must then be entered before the program enters the function to enter a new password. The software will blink two green LEDs at different speeds to indicate whether the password was correctly change or not.

\subsection{Serial Peripheral Interface}
Jordan

**********( Talk about both sides of the SPI communication on Pi and ATMEGA)******
\subsection{Web Interface and Web Server}
The web interface and Android application both have a similar look and setup to the interface. The web interface is hosted by the Raspberry Pi which is physically connected to the system that is mounted on the door. The web server that is hosting the website interface also provides information for the Android application to obtain. The website interface was designed with some programming logic and the frameworks PHP, JavaScript, and then the markup language of HTML. Figure *********** below displays a screen shots of the user interface setup of the website interface. 

***************** WEBSITE INTERFACE SCREEN SHOTS *****************

The markup language HTML is used for displaying the information on the website shown above in a neat and user friendly manner. The HTML handles the displaying the buttons, text fields, images, and organizing the activity log in a table. A block diagram showing how the website software functions is shown below in Figure *******. 

******************* WEBSITE BLOCK DIAGRAM FLOW ******************

The HTML scripts use JavaScript to call the external PHP files to retrieve the locks state, lights state, cameras state, and activity data from an SQL database. The website interface also provides a web page that allows the owner of the system to change the password that is used to log into the Android application.

\subsection{Android Application}
The Android application which was written entirely using the programming language know as Java. The look and feel of the Android application is extremely similar to the website interface and this can be seen below in Figure **** which shows a few screen shots of the application.

************* ANDROID APPLICATION SCREEN SHOTS *****************

As shown above the first page the user will see when the application is opened is the log in page. The log in requires a default user email that isn't changeable and a password which can be both changed from the website and Android application. When the log in button is pressed the application will web scrape the web server being hosted on the Raspberry Pi to check to see if the account exists. The next page is simply a homepage where the user can navigate to different parts of the application depending on what they would like to monitor at their home. The three other pages within this application are mainly using a web view of the web interface pages that would specifically designed for a mobile format on a smart phone. The web viewing technique is the reason that both the Android application and web site interface have such a similar look and feel. Below in Figure **** shows how the software behind the android application functions.

************ Block Diagram of android application software ****

Outside of the software that was written to handle the text field, buttons, and web views there are two main parts to the software of this application. These parts consist of the method to web scrape the information from the web server and the background process to monitor the doorbell activity at the door. The web scraping involves retrieving the users credentials to log it, doorbell state, and images of the doors surroundings.  

% % % % % % % % % % % % % % %		
% Results
\chapter{Results}
After the hardware was designed and the software was developed multiple tests were performed to verify each specification was met. All specifications from the proposed contract were met. Two extra features were added to the project and were successfully completed. These features include the doorbell monitoring feature and the lock position sensors. Measurements for the specifications are discussed in more detail below. The background process can be turned on or off from a page in the application and when the process is running it is checking the web server for the current state of the doorbell. As soon as the process sees that the doorbell has been pressed it will display a notification on the deceive to notify the user the doorbell has been rung.  A few seconds after this notification a second notification will pop up which if clicked on takes the user to a page that display four different pictures of the person who has rung the doorbell.

\section{Stepper Motor}
Jordan

\section{Keypad Interface}
Chris

\section{Wireless Control}
Chris
*** Mention web view on android application increased performance and less delay instead of manually retrieving information ***
% % % % % % % % % % % % % % %		
% Conclusion
\chapter{Conclusion}
Jordan

% % % % % % % % % % % % % % %		
% Appendices
\appendix
\chapter{List of Sources}
[1] Andras Tantos, “H-Bridges - the basics”, www.modularcircuits.com/blog/articles/h-bridge-secrets/h-bridges-the-basics/

[2] Robot Room, “H-Bridge Motor Driver Using Bipolar Transistors”, www.robotroom.com/BipolarHBridge.html

[3] Electronics Tutorials, “Triac Tutorial”, www.electronics-tutorials.ws/power/triac.html

[4] AsmyIdof StackExchange user, “Transistor Battery Backup Circuit”, www.electronics.stackexchange.com/a/179355

[5] Dakota Carll and Chris Martin, Advice on Battery Backup component selection

[6] Andrew Sheaff and Nuri Emanetoglu

[7] Nick Levesque, Soldering equipment and advice
\chapter{Project Contract}
\textbf{Summary \& Function:}

This project will allow a user to unlock or lock a door in a short period of time from an Android application, web interface, or keypad. The user will also be able to control lights outside the door and take a picture of outside the door. From the keypad the user will be able to set a new password and there will also be a light emitting diode (LED) to indicate the state of the lock. 

\textbf{Inputs:}
\begin{itemize}
  \item Android Application
  \item Web interface
  \item Keypad
\end{itemize}

\textbf{Outputs:}
\begin{itemize}
  \item Lock/Unlock Action of Deadbolt
  \item Turn on or off 120VAC Light
  \item Picture of outside of door
  \item LED Indicator of Lock Status
\end{itemize}

\textbf{Specifications:}
\begin{itemize}
  \item Deadbolt will be moved with a stepper motor, a stepper motor driver circuit will be designed capable of supplying one amp per phase.
  \item Turn on and off 120VAC light with a rating of at least 60 Watts without use of a relay.
  \item The motor driver will be controlled with an embedded processor, without using a development board or pre-existing libraries not included in the hardware abstraction layer.
  \item A Battery Backup circuit will be designed. 
  \item After keypad code is entered by the user the lock should lock/unlock in under 3 seconds.
  \item State of Lock will be displayed on Android application and next to keypad with LEDs.
  \item Record Log of door locks, unlocks, and display log of locks/unlocks on Android  Application and web interface. 
  \item Let user reset password on the keypad.  
  \item View a picture, from the Pi, on android app from camera attached to the raspberry pi. 
\end{itemize}
\begin{verbatim}
    ___________________________________		       _______________________________                       
    Christopher Verbitzki   May 12, 2016        Jordan Millett   May 12, 2016
\end{verbatim}

\chapter{Schematics}
\begin{figure}[H]
\centering
\includegraphics[scale=1.2, angle=90]{Schematic.JPG}
\caption{Functional block diagram of Door Lock Monitoring System}
\label{fig:BlockDiag}
\end{figure}

\chapter{Parts List}
\begin{tabular}{ |p{5cm}||p{3cm}|p{1.5cm}|p{0.5cm}|p{2cm}|p{2cm}|  }
 \hline
 \multicolumn{6}{|c|}{Parts List} \\ 
 \hline
 \textbf{Component}&  \textbf{Part Number}& \textbf{Vendor}&\textbf{Qty}&  \textbf{Unit Cost} &  \textbf{Total Cost}\\
 \hline
 \hline
 TRIAC Standard 400V 12A Through Hole&MAC12DGOS-ND&DigiKey&1&\$0.97&\$0.97\\
 \hline
  Optoisolator Triac &MOC3010M&DigiKey&1&\$0.72&\$0.72\\
 \hline
  TRANS NPN DARL 100V 2A&497-2533-5-ND&DigiKey&4&\$0.57&\$2.28\\
  \hline
  TRANS NPN DARL 60V 2A&497-2619-5-ND&DigiKey&1&\$0.65&\$2.60\\
   \hline
  AVR AVR® ATmega Microcontroller IC 8-Bit 20MHz 8KB (4K x 16) FLASH 28-PDIP
&ATMEGA88A-PU-ND&DigiKey&1&\$3.25&\$3.25\\
   \hline
  Linear Voltage Regulator IC Positive Fixed 1 Output 5V 1.5A &497-1443-5-ND&DigiKey&1&\$0.44&\$0.44\\
  \hline
  0.33µF 50V Ceramic Capacitor Z5U Radial&399-9882-1-ND&DigiKey&1&\$0.43&\$0.43\\
  \hline
  0.1µF 50V Ceramic Capacitor Z5U Radial&399-14010-1-ND&DigiKey&1&\$0.23&\$0.23\\
  \hline
  Infrared (IR) Emitter 940nm 1.2V 100mA 60mW/sr @ 100mA 60° Radial&OED-EL-1L2&DigiKey&2&\$0.49&\$0.49\\
  \hline
  4Phototransistor 900nm Top View Radial&160-1987-ND&DigiKey&2&\$0.51&\$1.02\\
  \hline
  26 Position Header Connector 0.100" (2.54mm) Through Hole Gold&S7116-ND&DigiKey&1&\$1.96&\$1.96\\
  \hline
  Red, Green, Blue LED (RGB)&754-1492-ND&DigiKey&1&\$1.78&\$1.78\\
  \hline
  4 Position Wire to Board Terminal Block Horizontal with Board 0.138" (3.50mm) Through Hole&ED2742-ND&DigiKey&2&\$0.67&\$1.34\\
  \hline
  Power Barrel Connector Jack 2.10mm ID (0.083"), 5.50mm OD (0.217") Through Hole&732-5931-ND&DigiKey&1&\$1.15&\$1.15\\
  \hline
  Diode Schottky 20V 3A Through Hole DO-201AD&1N5820-E3/54GICT-ND&DigiKey&2&\$0.42&\$0.84\\
  \
  \end{tabular}
  
  
\begin{tabular}{ |p{5cm}||p{3cm}|p{1.5cm}|p{0.5cm}|p{2cm}|p{2cm}|  }
 \hline
  MOSFET P-CH 100V 1A 4-DIP&IRFD9120-ND&DigiKey&1&\$0.87&\$0.87\\
  \hline
  Power Entry Connector Receptacle, Female Sockets NEMA 5-15 Panel Mount, Snap-In&Q227-ND&DigiKey&1&0.94&\$0.94\\
  \hline
  8 Positions Header, Unshrouded Connector 0.079" (2.00mm) Through Hole Gold&3M9327-ND&DigiKey&2&\$0.51&\$1.02\\
  \hline
  4x4 Keypad& N/A&N/A&1&\$5.00&\$5.00\\
  \hline
  Resistors (100k?, 10k?, 15k?, 1k?, 470?, 180?)&N/A&N/A&20&\$0.00475&\$0.095\\
  \hline
  5V 2A (2000mA) switching power supply - UL Listed&276&AdaFruit&1&\$7.95&\$7.95\\
  \hline
  Raspberry Pi Camera Board v2 - 8 MegaPixels&3099&AdaFruit&1&\$29.95&\$29.95\\
  \hline
  Stepper Motor -125 oz.in (200 setps/rev, 600mm)&ROB-13656&SparkFun&1&\$21.56&\$21.65\\
  \hline
  Raspberry Pi 3B&DEV-13825&SparkFun&1&\$39.95&\$39.95\\
  \hline
  4.75" x 2.25" Printed Circuit Board&N/A&OSH Park& 1 &\$17.81&\$17.81\\
    \hline
\end{tabular}


\end{document}


